---
layout: single
title: Schedule
permalink: /schedule/
classes: wide
---

# LangLunches Schedule

All sessions are held on Wednesdays at 12:00 and 12:30.

<div class="calendar-legend">
    <div class="legend-item">
        <div class="legend-color calendar-event"></div>
        <span>Available</span>
    </div>
    <div class="legend-item">
        <div class="legend-color calendar-full"></div>
        <span>Fully Booked</span>
    </div>
</div>

<div id="calendar-container" class="calendar-container">
    <!-- Calendar will be generated by JavaScript -->
</div>

<dialog id="eventDialog">
    <div class="dialog-content">
        <h3>Event Details</h3>
        <div id="eventDetails"></div>
        <div class="dialog-buttons">
            <button onclick="closeEventDialog()">Close</button>
        </div>
    </div>
</dialog>

<dialog id="bookingDialog">
    <div class="dialog-content">
        <h3>Request Booking</h3>
        <form id="bookingForm">
            <input type="hidden" id="bookingDate" name="date">
            <div class="form-group">
                <label for="speaker">Speaker Name:</label>
                <input type="text" id="speaker" name="speaker" required>
            </div>
            <div class="form-group">
                <label for="title">Talk Title:</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="dialog-buttons">
                <button type="button" onclick="closeBookingDialog()">Cancel</button>
                <button type="submit">Submit</button>
            </div>
        </form>
    </div>
</dialog>

<style>
.calendar-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.month-container {
    margin-bottom: 40px;
}

.month-container h3 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-bottom: 30px;
}

.calendar-header {
    text-align: center;
    font-weight: bold;
    padding: 10px;
    background: #f0f0f0;
}

.calendar-day {
    text-align: center;
    padding: 10px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.calendar-wednesday {
    background: #e6ffe6 !important;
    cursor: pointer !important;
}

.calendar-wednesday:hover {
    background: #d4ffd4 !important;
}

.calendar-event {
    background: #90EE90 !important;
    cursor: pointer !important;
}

.calendar-event:hover {
    background: #7fdd7f !important;
}

.calendar-full {
    background: #ff6b6b !important;
    cursor: pointer !important;
}

.calendar-full:hover {
    background: #ff5252 !important;
}

.calendar-past {
    background: #f0f0f0 !important;
    color: #999 !important;
    cursor: not-allowed !important;
}

.calendar-empty {
    background: #f9f9f9;
}

dialog {
    padding: 20px;
    border-radius: 5px;
    border: 1px solid #ddd;
    max-width: 500px;
    width: 90%;
    position: relative;
    z-index: 1000;
}

dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.5);
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

button {
    padding: 8px 16px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
}

button:hover {
    background: #45a049;
}

.calendar-legend {
    display: flex;
    gap: 20px;
    margin: 20px auto;
    justify-content: center;
    max-width: 1200px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 4px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    console.log("Calendar script loaded");
    
    // Load events from Jekyll data
    const events = {{ site.data.events.events | jsonify }};
    console.log("Loaded events:", events);
    
    // Get current date
    const currentDate = new Date();
    const currentYear = currentDate.getFullYear();
    const currentMonth = currentDate.getMonth();
    
    // Generate calendar for the next 6 months
    const calendarContainer = document.getElementById("calendar-container");
    
    for (let monthOffset = 0; monthOffset < 6; monthOffset++) {
        const month = new Date(currentYear, currentMonth + monthOffset, 1);
        const year = month.getFullYear();
        const monthName = month.toLocaleString('default', { month: 'long' });
        
        // Create month container
        const monthContainer = document.createElement("div");
        monthContainer.className = "month-container";
        
        // Add month title
        const monthTitle = document.createElement("h3");
        monthTitle.textContent = `${monthName} ${year}`;
        monthContainer.appendChild(monthTitle);
        
        // Create calendar grid
        const calendarGrid = document.createElement("div");
        calendarGrid.className = "calendar-grid";
        
        // Add day headers
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        days.forEach(day => {
            const dayHeader = document.createElement("div");
            dayHeader.className = "calendar-header";
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
        });
        
        // Get first day of the month (0 = Sunday, 1 = Monday, etc.)
        const firstDay = month.getDay();
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDay; i++) {
            const emptyCell = document.createElement("div");
            emptyCell.className = "calendar-empty";
            calendarGrid.appendChild(emptyCell);
        }
        
        // Get number of days in the month
        const daysInMonth = new Date(year, month.getMonth() + 1, 0).getDate();
        
        // Add cells for each day of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const dayCell = document.createElement("div");
            dayCell.className = "calendar-day";
            
            // Format date as YYYY-MM-DD
            const dateStr = `${year}-${String(month.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            // Check if it's a Wednesday
            const dayOfWeek = new Date(year, month.getMonth(), day).getDay();
            const isWednesday = dayOfWeek === 3;
            
            // Check if it's in the past
            const isPast = new Date(dateStr) < new Date(currentDate.toISOString().split('T')[0]);
            
            // Check if there are events for this day
            const dayEvents = events.find(event => event.date === dateStr);
            
            if (dayEvents) {
                // Count booked slots
                const bookedSlots = dayEvents.slots.filter(slot => slot.title && slot.speaker).length;
                
                if (bookedSlots === 2) {
                    dayCell.classList.add("calendar-full");
                } else if (bookedSlots === 1) {
                    dayCell.classList.add("calendar-event");
                }
                
                // Add event data
                dayCell.setAttribute("data-date", dateStr);
                dayCell.setAttribute("data-events", JSON.stringify(dayEvents.slots));
                
                // Add click handler
                if (!isPast) {
                    dayCell.addEventListener("click", () => showEventDialog(dateStr, dayEvents.slots));
                }
            } else if (isWednesday && !isPast) {
                // Add empty event data for Wednesdays
                dayCell.setAttribute("data-date", dateStr);
                dayCell.setAttribute("data-events", JSON.stringify([{title: "", speaker: ""}, {title: "", speaker: ""}]));
                dayCell.addEventListener("click", () => showEventDialog(dateStr, [{title: "", speaker: ""}, {title: "", speaker: ""}]));
            }
            
            if (isPast) {
                dayCell.classList.add("calendar-past");
            }
            
            dayCell.textContent = day;
            calendarGrid.appendChild(dayCell);
        }
        
        monthContainer.appendChild(calendarGrid);
        calendarContainer.appendChild(monthContainer);
    }
});

function showEventDialog(date, slots) {
    const dialog = document.getElementById("eventDialog");
    const details = document.getElementById("eventDetails");
    
    // Clear previous content
    details.innerHTML = "";
    
    // Add date header
    const dateHeader = document.createElement("h4");
    dateHeader.textContent = new Date(date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    details.appendChild(dateHeader);
    
    // Add slots
    slots.forEach((slot, index) => {
        const slotDiv = document.createElement("div");
        slotDiv.className = "event-slot";
        
        if (slot.title && slot.speaker) {
            slotDiv.innerHTML = `
                <h5>Slot ${index + 1}</h5>
                <p><strong>Speaker:</strong> ${slot.speaker}</p>
                <p><strong>Title:</strong> ${slot.title}</p>
            `;
        } else {
            slotDiv.innerHTML = `
                <h5>Slot ${index + 1}</h5>
                <p>Available</p>
                <button onclick="showBookingDialog('${date}', ${index})">Request Booking</button>
            `;
        }
        
        details.appendChild(slotDiv);
    });
    
    dialog.showModal();
}

function closeEventDialog() {
    const dialog = document.getElementById("eventDialog");
    dialog.close();
}

function showBookingDialog(date, slotIndex) {
    const dialog = document.getElementById("bookingDialog");
    const form = document.getElementById("bookingForm");
    const dateInput = document.getElementById("bookingDate");
    
    dateInput.value = `${date}|${slotIndex}`;
    dialog.showModal();
}

function closeBookingDialog() {
    const dialog = document.getElementById("bookingDialog");
    dialog.close();
}

document.getElementById("bookingForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const [date, slotIndex] = formData.get("date").split("|");
    const speaker = formData.get("speaker");
    const title = formData.get("title");
    
    // Create GitHub issue
    const issueBody = `
Date: ${date}
Slot: ${parseInt(slotIndex) + 1}
Speaker: ${speaker}
Title: ${title}
    `.trim();
    
    try {
        const response = await fetch(`https://api.github.com/repos/${window.location.pathname.split('/')[1]}/issues`, {
            method: 'POST',
            headers: {
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json',
                'Authorization': `token ${localStorage.getItem('github_token')}`
            },
            body: JSON.stringify({
                title: `Booking Request: ${date} - ${speaker}`,
                body: issueBody,
                labels: ['booking-request']
            })
        });
        
        if (response.ok) {
            alert("Booking request submitted successfully!");
            closeBookingDialog();
            closeEventDialog();
        } else {
            throw new Error('Failed to create issue');
        }
    } catch (error) {
        console.error('Error:', error);
        alert("Failed to submit booking request. Please try again later.");
    }
});
</script>
